---
title: C#ã§ãƒ¬ã‚¸ã‚¹ãƒˆãƒªã‚’ã„ã˜ã£ã¦ã‚¹ã‚¿ãƒ¼ãƒˆã‚¢ãƒƒãƒ—ã«ã™ã‚‹
tags:
  - C#
  - ãƒ¬ã‚¸ã‚¹ãƒˆãƒª
private: false
updated_at: '2020-11-01T13:46:41+09:00'
id: 791a250127547646f1c4
organization_url_name: null
slide: false
---
#ï¼‘è¡Œæ¦‚è¦
C#ã§ãƒ¬ã‚¸ã‚¹ãƒˆãƒªã‚­ãƒ¼HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Runã‚’ã„ã˜ã£ã¦ä»»æ„ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’ã‚¹ã‚¿ãƒ¼ãƒˆã‚¢ãƒƒãƒ—ã«è¨­å®šã™ã‚‹ã€‚

#ã¯ã˜ã‚ã«
å…ˆæ—¥ã€å¥½ããªãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã«åˆPRãƒ»ãƒãƒ¼ã‚¸ã•ã‚ŒãŸğŸ‰
![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/488859/5da0def8-f7ad-7e66-71cd-62b4c2a03224.png)

ãã®ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã¨ã¯ã€[Windowsã®ã‚¿ã‚¹ã‚¯ãƒãƒ¼ã§ã‚‚ãƒã‚³èµ°ã‚‰ã›ã¦ã¿ãŸğŸˆ](https://qiita.com/Kyome/items/47aac4979933dac12263)ã§è¨˜äº‹ã«ãªã£ã¦ã„ã‚‹ã€**RunCat for Windows**ã€ã ã€‚
ã‚¿ã‚¹ã‚¯ãƒãƒ¼ã«å¸¸é§ã—ã€CPUè² è·ç‡ã«å¿œã˜ã¦ãƒã‚³ãŒèµ°ã‚‹ã¨ã„ã†ã‚‚ã®ã€‚æœ‰åãªã‚¢ãƒ—ãƒªãªã®ã§çŸ¥ã£ã¦ã„ã‚‹æ–¹ã‚‚å¤šã„ã¯ãšã€‚

ç§ãŒPRã§è¿½åŠ ã—ãŸã®ã¯ã€ã‚¢ãƒ—ãƒªã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚¢ã‚¤ãƒ†ãƒ ã«**ã‚¹ã‚¿ãƒ¼ãƒˆã‚¢ãƒƒãƒ—**ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’åŠ ãˆã‚‹ã¨ã„ã†ã‚‚ã®ã€‚
![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/488859/dd9470e4-74b4-1be8-fc23-4247e19a0f6e.png)

æœ¬è¨˜äº‹ã¯ãƒãƒ¼ã‚¸è¨˜å¿µã¨ã—ã¦ã€å®Ÿéš›ã®ä¿®æ­£å†…å®¹ã‚’ãƒ™ãƒ¼ã‚¹ã«C#ã§ãƒ¬ã‚¸ã‚¹ãƒˆãƒªã‚­ãƒ¼ã‚’ã„ã˜ã£ã¦ã‚¹ã‚¿ãƒ¼ãƒˆã‚¢ãƒƒãƒ—ã«ç™»éŒ²ã™ã‚‹æ–¹æ³•ã‚’è¨˜è¿°ã™ã‚‹ã€‚

#æ—©ã„è©±ãŒ
ã‚¹ã‚¿ãƒ¼ãƒˆã‚¢ãƒƒãƒ—ã«çºã‚ã‚‹ãƒ¬ã‚¸ã‚¹ãƒˆãƒªã‚­ãƒ¼ã¯4ã¤ã€‚

- HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Run
- HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\RunOnce
- HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run
- HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\RunOnce

ä¸Š2ã¤ã¯ãƒ«ãƒ¼ãƒˆãŒ*HKEY_CURRENT_USER*ã§ãƒã‚·ãƒ³ã®å…¨ãƒ¦ãƒ¼ã‚¶ã«å¯¾è±¡ã¨ãªã‚‹ã‚‚ã®ã€ä¸‹2ã¤ã¯*HKEY_CURRENT_USER*ã§ç¾åœ¨ãƒ­ã‚°ã‚¤ãƒ³ä¸­ã®ãƒ¦ãƒ¼ã‚¶ã«å¯¾è±¡ã¨ãªã‚‹ã‚‚ã®ã€‚
æœ«å°¾ã®*Run*ã¨*RunOnce*ã®é•ã„ã¯1å›ãã‚Šã‹åŠæ°¸ä¹…çš„ã«ã‹ã¨ã„ã†ã‚‚ã®ã€‚

ä»Šå›ã¯ä¸Šã‹ã‚‰3ã¤ç›®ã€**HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run**ã®å€¤ã‚’ã„ã˜ã‚‹ã€‚
![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/488859/e0c79b54-db2d-db11-4815-1d56bb9b20cf.png)

#C#ã‹ã‚‰ãƒ¬ã‚¸ã‚¹ãƒˆãƒªã‚’ã„ã˜ã‚‹
MarshalByRefObject.[RegistryKey](https://docs.microsoft.com/ja-jp/dotnet/api/microsoft.win32.registrykey?view=dotnet-plat-ext-3.1)ã‚¯ãƒ©ã‚¹ã«Windowsãƒ¬ã‚¸ã‚¹ãƒˆãƒªã‚’æ‰±ã†ãƒ¡ã‚½ãƒƒãƒ‰ãŒç”¨æ„ã•ã‚Œã¦ã„ã‚‹ã€‚
å„ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ã¯æ¬¡ã®é€šã‚Šã€‚

###[RegistryKey.GetValue](https://docs.microsoft.com/ja-jp/dotnet/api/microsoft.win32.registrykey.getvalue?view=dotnet-plat-ext-3.1)
**public object GetValue (string name, object defaultValue, Microsoft.Win32.RegistryValueOptions options)**
æŒ‡å®šã—ãŸåå‰ã«é–¢é€£ä»˜ã‘ã‚‰ã‚Œã¦ã„ã‚‹å€¤ã‚’ã€å–å¾—ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’æŒ‡å®šã—ã¦å–å¾—ã™ã‚‹ã€‚ åå‰ãŒè¦‹ã¤ã‹ã‚‰ãªã„å ´åˆã€è¨­å®šã•ã‚Œã¦ã„ã‚‹æ—¢å®šå€¤ã‚’è¿”ã™ã€‚
####ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼
**name** : String å–å¾—ã™ã‚‹å€¤ã®åå‰ã€‚ ã“ã®æ–‡å­—åˆ—ã®å¤§æ–‡å­—ã¨å°æ–‡å­—ã¯åŒºåˆ¥ã•ã‚Œãªã„ã€‚
**defaultValue** : Object name ãŒå­˜åœ¨ã—ãªã„å ´åˆã«è¿”ã™å€¤ã€‚
**options** : RegistryValueOptions å–å¾—ã—ãŸå€¤ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®å‡¦ç†ã‚’æŒ‡å®šã™ã‚‹åˆ—æŒ™å€¤ã® 1 ã¤ã€‚
####æˆ»ã‚Šå€¤
**Object** name ã«é–¢é€£ä»˜ã‘ã‚‰ã‚ŒãŸå€¤ã‚’ã€æŒ‡å®šã—ãŸ options ã«å¾“ã£ã¦å‡¦ç†ã—ãŸã‚‚ã®ã€‚defaultValue ãŒè¦‹ã¤ã‹ã‚‰ãªã‹ã£ãŸå ´åˆã¯ nameã€‚

###[RegistryKey.SetValue](https://docs.microsoft.com/ja-jp/dotnet/api/microsoft.win32.registrykey.setvalue?view=dotnet-plat-ext-3.1)
**public void SetValue (string name, object value)**
æŒ‡å®šã—ãŸåå‰/å€¤ãƒšã‚¢ã‚’è¨­å®šã™ã‚‹ã€‚

####ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼
**name** : String æ ¼ç´ã™ã‚‹å€¤ã®åå‰ã€‚
**value** : Object æ ¼ç´ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ã€‚

###[RegistryKey.DeleteValue](https://docs.microsoft.com/ja-jp/dotnet/api/microsoft.win32.registrykey.deletevalue?view=dotnet-plat-ext-3.1)
**public void DeleteValue (string name)**
æŒ‡å®šã—ãŸå€¤ã‚’ã“ã®ã‚­ãƒ¼ã‹ã‚‰å‰Šé™¤ã™ã‚‹ã€‚
####ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼
name : String å‰Šé™¤ã™ã‚‹å€¤ã®åå‰ã€‚

###[RegistryKey.Close](https://docs.microsoft.com/ja-jp/dotnet/api/microsoft.win32.registrykey.close?view=dotnet-plat-ext-3.1)
**public void Close ()**
ã‚­ãƒ¼ã‚’é–‰ã˜ã€ã‚­ãƒ¼ã®å†…å®¹ãŒå¤‰æ›´ã•ã‚Œã¦ã„ã‚‹å ´åˆã¯ãƒ‡ã‚£ã‚¹ã‚¯ã¸ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ã™ã‚‹ã€‚

#å®Ÿéš›ã®ã‚³ãƒ¼ãƒ‰
è¿½åŠ ã‚’ã—ãŸãƒ¡ã‚½ãƒƒãƒ‰ã¯ä¸»ã«æ¬¡ã®2ã¤ã ã€‚

###SetStartup
ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚¢ã‚¤ãƒ†ãƒ ã®ã‚¹ã‚¿ãƒ¼ãƒˆã‚¢ãƒƒãƒ—ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸéš›ã«ç™ºç«ã™ã‚‹å‡¦ç†ã€‚
ãƒ©ã‚¸ã‚ªãƒã‚§ãƒƒã‚¯ã®å€¤ã‚’åˆ‡ã‚Šæ›¿ãˆã€ã‚ªãƒ³/ã‚ªãƒ•ã«å¿œã˜ã¦ãƒ¬ã‚¸ã‚¹ãƒˆãƒªã‚­ãƒ¼ã‚’ã‚»ãƒƒãƒˆ/å‰Šé™¤ã™ã‚‹ã€‚

```Program.cs
private void SetStartup(object sender, EventArgs e)
{
    startupMenu.Checked = !startupMenu.Checked;
    string keyName = @"Software\Microsoft\Windows\CurrentVersion\Run";
    using (RegistryKey rKey = Registry.CurrentUser.OpenSubKey(keyName, true))
    {
        if (startupMenu.Checked)
        {
            rKey.SetValue(Application.ProductName, Application.ExecutablePath);
        }
        else
        {
            rKey.DeleteValue(Application.ProductName, false);
        }
        rKey.Close();
    }
}
```

###IsStartupEnabled
ãƒ¬ã‚¸ã‚¹ãƒˆãƒªã®å€¤ã‚’èª­ã¿è¾¼ã¿ã€nullã§ãªã„ï¼ˆ=IsStartupEnabledï¼‰ãªã‚‰trueã‚’ã€nullï¼ˆ=IsNotStartupEnabledï¼‰ãªã‚‰falseã‚’è¿”ã™ã€‚

```Program.cs
private bool IsStartupEnabled()
{
    string keyName = @"Software\Microsoft\Windows\CurrentVersion\Run";
    using (RegistryKey rKey = Registry.CurrentUser.OpenSubKey(keyName))
    {
        return (rKey.GetValue(Application.ProductName) != null) ? true : false;
    }
}
```

#ãŠã‚ã‚Šã«
ä»Šå›ã¯C#ã§ãƒ¬ã‚¸ã‚¹ãƒˆãƒªã‚­ãƒ¼HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Runã‚’ã„ã˜ã£ã¦ä»»æ„ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’ã‚¹ã‚¿ãƒ¼ãƒˆã‚¢ãƒƒãƒ—ã«è¨­å®šã™ã‚‹å†…å®¹ã‚’èª¬æ˜ã—ãŸã€‚
å¥½ããªãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã«PRãŒé€šã£ãŸã“ã¨ã¯ç´ ç›´ã«ã†ã‚Œã—ã„çµŒé¨“ã ã£ãŸã€‚
